<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Transcription view</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/transcription/assets/css/bootstrap.css" rel="stylesheet">
    <link href="/static/transcription/tableView.css" rel="stylesheet">
    
    <link href="/static/transcription/chosen/chosen/chosen.css" rel="stylesheet">
    
  </head>

  <body>
  	<form action="/save_transcription/" method="post">{% csrf_token %}
  		<div style="position:fixed;background-color:white;width:100%;">
			<h1 style="float:left;">{{json_template_name}}</h1>
			<button class="btn save" type="submit" style="float:right;">
				Save
			</button>
		</div>
		<h1>_</h1>
		<table class="table table-striped table-bordered">
		<tr>
		{% for field in json_template.fields %}
			{% if not field.mask %}
				{% if field.label %}
					<th id="{{field.name}}">
						<span class="label label-info">{{field.label}}</span>
						<i class="icon-eye-open"></i>
					</th>
				{% else %}
					<th>{{field.name}}</th>
				{% endif %}
			{% endif %}
		{% empty %}
			<p>No fields in template</p>
		{% endfor %}
		</tr>
	    {% for json_output in json_outputs %}
			<tr>
			{% for field in json_output.fields %}
				{% if not field.mask %}
					<td class="{{field.name}}">
						{% if "select" in field.type %}
							<select
							{% if field.type == "select" %}
							multiple
							{% endif %}
							name="{{json_output.formImage.id}}-{{field.name}}">
								{% for item in field.segments.0.items %}
									<option value="{{item.value}}"
									{% if field.transcription %}{% comment %} Empty string? {% endcomment %}
										{% if item.value in field.transcription %}selected{% endif %}
									{% else %}
										{% if item.value in field.value %}selected{% endif %}
									{% endif %}
									>
									{% firstof item.label item.value %}
									</option>
								{% endfor %}
							</select>
						{% else %}
							<input name="{{json_output.formImage.id}}-{{field.name}}" value="{% firstof field.transcription field.value %}"></input>
						{% endif %}
						<br />
						<div class="segments">
						{% for segment in field.segments %}
							{% comment %} Not sure if this scaling technique works everywhere. {% endcomment %}
							<div class="segment-container">
								<a href="/formView?segment={{segment.name}}&formLocation=/media/{{json_output.outputDir}}/&formId={{json_output.formImage.id}}&user={{user}}">
								<img 
								src="/media/{{json_output.outputDir}}/segments/{{segment.name}}.jpg"
								style="height:{{segment.height_inches}}in; width:{{segment.width_inches}}in;" />
								</a>
							</div>
						{% endfor %}
						</div>
					</td>
				{% endif %}
			{% endfor %}
			</tr>
		{% empty %}
			<p>No output available.</p>
	    {% endfor %}
		</table>
	</form>
	<script src="/static/transcription/assets/js/jquery.js"></script>
    <script src="/static/djangoCSRF.js" type="text/javascript"></script>
    <script src="/static/transcription/chosen/chosen/chosen.jquery.min.js" type="text/javascript"></script>
    <script src="/static/transcription/tableView.js"></script>
  </body>
</html>