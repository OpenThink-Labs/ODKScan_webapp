<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Transcription view</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/static/transcription/assets/css/bootstrap.css" rel="stylesheet">
    <link href="/static/transcription/tableView.css" rel="stylesheet">
    
  </head>

  <body>
  	<form action="/save_transcription/" method="post">{% csrf_token %}
  		<div class="header">
			<h1 style="float:left;">{{template_name}}</h1>
            <div style="float:left;margin-left: 40px;" class="btn-group">
                <button class="btn"><i class="icon-plus"></i> Zoom images</button>
                <button class="btn">Shrink images <i class="icon-minus"></i></button>
            </div>
			<button class="btn save" type="submit" style="float:right;">
				Save
			</button>
		</div>
		<h1>_</h1>
		<table class="table table-striped table-bordered">
		<tr>
		<th>Image Name</th>
		{% for field in json_template.fields %}
			{% if not field.mask %}
				{% if field.label %}
					<th id="{{field.name}}">
						<span class="label label-info">{{field.label}}</span>
						<i class="icon-eye-open"></i>
					</th>
				{% else %}
					<th>{{field.name}}</th>
				{% endif %}
			{% endif %}
		{% empty %}
			<p>No fields in template</p>
		{% endfor %}
		</tr>
	    {% for json_output in json_outputs %}
			<tr>
			<td>{{json_output.imageName}}</td>
			{% for field in json_output.fields %}
				{% if not field.mask %}
					<td class="{{field.name}}">
						{% if "select" in field.type %}
							<select
							{% if field.type == "select" %}
							multiple
							{% endif %}
							name="{{json_output.form_id}}-{{field.name}}">
								<option value>
								{% for item in field.segments.0.items %}
									<option value="{{item.value}}"
									{% if autofill %}
										{% if field.transcription %}{% comment %} Empty string? {% endcomment %}
											{% if item.value in field.transcription %}selected{% endif %}
										{% else %}
											{% if item.value in field.value %}selected{% endif %}
										{% endif %}
									{% endif %}
									>
									{% firstof item.label item.value %}
									</option>
								{% endfor %}
							</select>
						{% else %}
							<input name="{{json_output.form_id}}-{{field.name}}" value="{% if autofill %}{% firstof field.transcription field.value %}{% endif %}"></input>
						{% endif %}
						<br />
						<div class="segments">
						{% if showSegs %}
						{% for segment in field.segments %}
							<div class="segment-container">
								<img 
								class="segment"
								formId="{{json_output.form_id}}"
								fieldName="{{field.name}}"
								href="/formView?segment={{field.name}}_image_{{forloop.counter0}}&formLocation=/media/{{json_output.outputDir}}/&formId={{json_output.form_id}}&user={{user}}"
								src="/media/{{json_output.outputDir}}/segments/{{field.name}}_image_{{forloop.counter0}}.jpg"
                                height="{{segment.segment_height}}px"
                                width="{{segment.segment_width}}px"
								/>
							{% for item in field.segments.0.items %}
								<div class='label item-overlay' style="position:absolute;left:{{item.item_x}}px;top:{{item.item_y}}px;">{% firstof item.label item.value %}</div>
							{% endfor %}
							</div>
						{% endfor %}
						{% endif %}
						</div>
					</td>
				{% endif %}
			{% endfor %}
			</tr>
		{% empty %}
			<p>No output available.</p>
	    {% endfor %}
		</table>
	</form>
	<script src="/static/transcription/assets/js/jquery.js"></script>
    <script src="/static/djangoCSRF.js" type="text/javascript"></script>
    <script src="/static/transcription/shared.js" type="text/javascript"></script>
    <script src="/static/transcription/tableView.js"></script>
  </body>
</html>